---
- name: Build ROS 2 Workspace on lwf-vm
  hosts: lwf-vm
  become: no
  tasks:

    - name: Ensure /home/ros2/lwf exists
      file:
        path: /home/ros2/lwf
        state: directory

    - name: Pull newest commits
      shell: |
        git checkout main
        git reset HEAD --hard
        git pull
      args:
        chdir: /home/ros2/lwf

    - name: Build lwf container
      community.docker.docker_image:
        build:
          path: .
        name: 192.168.5.239:5000/lwf
        tag: latest
        dockerfile: docker/lwf.dockerfile
        push: true
        args:
          chdir: /home/ros2/lwf

    - name: Build lidar container
      community.docker.docker_image:
        build:
          path: .
        name: 192.168.5.239:5000/lidar
        tag: latest
        dockerfile: docker/rplidar.dockerfile
        push: true
        args:
          chdir: /home/ros2/lwf
